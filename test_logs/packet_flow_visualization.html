<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRER Packet Flow Visualization</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0;
            position: relative;
            min-height: 400px;
        }
        .device {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 200px;
            text-align: center;
            z-index: 10;
            position: relative;
        }
        .device.pc {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .device.board {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }
        .device h3 {
            margin: 0 0 10px 0;
            font-size: 1.2rem;
        }
        .device .ip {
            font-family: monospace;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .packet-animation {
            position: absolute;
            width: 30px;
            height: 20px;
            background: #4ade80;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(74, 222, 128, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
            z-index: 20;
        }
        .packet-animation.duplicate {
            background: #f59e0b;
        }
        .packet-animation.eliminated {
            background: #ef4444;
            opacity: 0.5;
        }
        .path {
            position: absolute;
            height: 3px;
            background: #cbd5e0;
            z-index: 1;
        }
        .path.active {
            background: linear-gradient(90deg, #4ade80, #3b82f6);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        button {
            padding: 10px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
        }
        .packet-detail {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            font-family: monospace;
            white-space: pre-wrap;
            display: none;
        }
        .packet-detail.show {
            display: block;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ FRER Packet Flow Visualization</h1>

        <div class="control-panel">
            <button onclick="startAnimation()">‚ñ∂Ô∏è Start Flow</button>
            <button onclick="stopAnimation()">‚è∏Ô∏è Pause</button>
            <button onclick="resetAnimation()">üîÑ Reset</button>
            <button onclick="simulateFailure()">‚ö†Ô∏è Simulate Link Failure</button>
        </div>

        <div class="flow-diagram" id="flowDiagram">
            <!-- Devices -->
            <div class="device pc" style="left: 50px;">
                <h3>Sender PC</h3>
                <div class="ip">10.0.100.1</div>
                <div>Traffic Gen</div>
            </div>

            <div class="device board" style="left: 350px;">
                <h3>Sender Board</h3>
                <div class="ip">LAN9662</div>
                <div>FRER Gen</div>
            </div>

            <div class="device board" style="left: 650px;">
                <h3>Receiver Board</h3>
                <div class="ip">LAN9662</div>
                <div>FRER Elim</div>
            </div>

            <div class="device pc" style="left: 950px;">
                <h3>Receiver PC</h3>
                <div class="ip">10.0.100.2</div>
                <div>Traffic Recv</div>
            </div>

            <!-- Paths -->
            <div class="path" style="left: 250px; top: 200px; width: 100px;"></div>
            <div class="path" style="left: 550px; top: 180px; width: 100px;" id="path1"></div>
            <div class="path" style="left: 550px; top: 220px; width: 100px;" id="path2"></div>
            <div class="path" style="left: 850px; top: 200px; width: 100px;"></div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #4ade80;"></div>
                <span>Original Packet</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <span>Duplicated Packet</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span>Eliminated Packet</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Packets Sent</div>
                <div class="stat-value" id="packetsSent">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Packets Duplicated</div>
                <div class="stat-value" id="packetsDuplicated">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Packets Eliminated</div>
                <div class="stat-value" id="packetsEliminated">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Packets Received</div>
                <div class="stat-value" id="packetsReceived">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Elimination Rate</div>
                <div class="stat-value" id="eliminationRate">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Paths</div>
                <div class="stat-value" id="activePaths">2</div>
            </div>
        </div>

        <div class="packet-detail" id="packetDetail">
<strong>Current Packet Details:</strong>
=====================================
Sequence Number: <span id="seqNum">0x0000</span>
Timestamp: <span id="timestamp">0.000000</span>

Sender Board eth1:
  Ethernet: 22:f7:00:32:c9:f1 ‚Üí 22:f7:00:32:c9:f1
  R-TAG: 0xF1C1 | Seq: <span id="seqHex1">0x0000</span>
  IPv4: 10.0.100.1 ‚Üí 10.0.100.2
  UDP: 45632 ‚Üí 5201

Sender Board eth2:
  Ethernet: 22:f7:00:32:c9:f2 ‚Üí 22:f7:00:32:c9:f2
  R-TAG: 0xF1C1 | Seq: <span id="seqHex2">0x0000</span>
  IPv4: 10.0.100.1 ‚Üí 10.0.100.2
  UDP: 45632 ‚Üí 5201

Receiver Processing:
  Path 1 Arrival: <span id="path1Arrival">0.000ms</span>
  Path 2 Arrival: <span id="path2Arrival">0.000ms</span>
  Decision: <span id="decision">PASS</span>
  Action: <span id="action">Forward to eth3</span>
        </div>
    </div>

    <script>
        let animationInterval;
        let packetCount = 0;
        let duplicatedCount = 0;
        let eliminatedCount = 0;
        let receivedCount = 0;
        let sequenceNumber = 1;
        let path1Active = true;
        let path2Active = true;

        function createPacket(x, y, label, className = '') {
            const packet = document.createElement('div');
            packet.className = `packet-animation ${className}`;
            packet.textContent = label;
            packet.style.left = `${x}px`;
            packet.style.top = `${y}px`;
            document.getElementById('flowDiagram').appendChild(packet);
            return packet;
        }

        function animatePacket(packet, startX, endX, duration, onComplete) {
            const start = Date.now();
            const distance = endX - startX;

            function update() {
                const elapsed = Date.now() - start;
                const progress = Math.min(elapsed / duration, 1);
                packet.style.left = `${startX + distance * progress}px`;

                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    if (onComplete) onComplete();
                }
            }

            requestAnimationFrame(update);
        }

        function sendPacket() {
            packetCount++;
            document.getElementById('packetsSent').textContent = packetCount;

            // Original packet from PC to Sender Board
            const packet1 = createPacket(150, 190, sequenceNumber % 100);
            animatePacket(packet1, 150, 350, 1000, () => {
                packet1.remove();

                // Duplication at Sender Board
                if (path1Active) {
                    duplicatedCount++;
                    document.getElementById('packetsDuplicated').textContent = duplicatedCount;
                    const dup1 = createPacket(450, 170, 'R1', 'duplicate');
                    animatePacket(dup1, 450, 650, 1000, () => {
                        // Process at receiver
                        if (Math.random() > 0.001) { // 99.9% elimination
                            eliminatedCount++;
                            document.getElementById('packetsEliminated').textContent = eliminatedCount;
                            dup1.classList.add('eliminated');
                            setTimeout(() => dup1.remove(), 500);
                        } else {
                            dup1.remove();
                        }
                    });
                }

                if (path2Active) {
                    duplicatedCount++;
                    document.getElementById('packetsDuplicated').textContent = duplicatedCount;
                    const dup2 = createPacket(450, 210, 'R2', 'duplicate');
                    animatePacket(dup2, 450, 650, 1100, () => {
                        dup2.remove();
                    });
                }

                // Deduplicated packet to Receiver PC
                setTimeout(() => {
                    receivedCount++;
                    document.getElementById('packetsReceived').textContent = receivedCount;
                    const final = createPacket(750, 190, '‚úì');
                    animatePacket(final, 750, 950, 1000, () => {
                        final.remove();
                    });

                    // Update elimination rate
                    const rate = eliminatedCount > 0 ?
                        ((eliminatedCount / duplicatedCount) * 100).toFixed(1) : 0;
                    document.getElementById('eliminationRate').textContent = `${rate}%`;
                }, 500);
            });

            // Update packet details
            updatePacketDetails();
            sequenceNumber++;
        }

        function updatePacketDetails() {
            const hexSeq = `0x${sequenceNumber.toString(16).padStart(4, '0').toUpperCase()}`;
            document.getElementById('seqNum').textContent = hexSeq;
            document.getElementById('seqHex1').textContent = hexSeq;
            document.getElementById('seqHex2').textContent = hexSeq;
            document.getElementById('timestamp').textContent = (Date.now() / 1000).toFixed(6);
            document.getElementById('path1Arrival').textContent = `${(0.089 + Math.random() * 0.05).toFixed(3)}ms`;
            document.getElementById('path2Arrival').textContent = `${(0.091 + Math.random() * 0.05).toFixed(3)}ms`;

            if (path1Active && path2Active) {
                document.getElementById('decision').textContent = 'DUPLICATE';
                document.getElementById('action').textContent = 'Forward first, eliminate second';
            } else if (path1Active || path2Active) {
                document.getElementById('decision').textContent = 'PASS';
                document.getElementById('action').textContent = 'Forward to eth3';
            } else {
                document.getElementById('decision').textContent = 'NO PATH';
                document.getElementById('action').textContent = 'Drop packet';
            }

            document.getElementById('packetDetail').classList.add('show');
        }

        function startAnimation() {
            if (animationInterval) return;

            // Mark paths as active
            document.getElementById('path1').classList.add('active');
            document.getElementById('path2').classList.add('active');

            animationInterval = setInterval(sendPacket, 2000);
            sendPacket(); // Send first packet immediately
        }

        function stopAnimation() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
        }

        function resetAnimation() {
            stopAnimation();
            packetCount = 0;
            duplicatedCount = 0;
            eliminatedCount = 0;
            receivedCount = 0;
            sequenceNumber = 1;
            path1Active = true;
            path2Active = true;

            document.getElementById('packetsSent').textContent = '0';
            document.getElementById('packetsDuplicated').textContent = '0';
            document.getElementById('packetsEliminated').textContent = '0';
            document.getElementById('packetsReceived').textContent = '0';
            document.getElementById('eliminationRate').textContent = '0%';
            document.getElementById('activePaths').textContent = '2';
            document.getElementById('packetDetail').classList.remove('show');

            // Remove all packet animations
            document.querySelectorAll('.packet-animation').forEach(p => p.remove());

            // Reset path states
            document.getElementById('path1').classList.remove('active');
            document.getElementById('path2').classList.remove('active');
        }

        function simulateFailure() {
            // Toggle path 2 failure
            path2Active = !path2Active;

            if (path2Active) {
                document.getElementById('path2').classList.add('active');
                document.getElementById('activePaths').textContent = '2';
                alert('Path 2 restored! FRER redundancy active.');
            } else {
                document.getElementById('path2').classList.remove('active');
                document.getElementById('activePaths').textContent = '1';
                alert('Path 2 failed! Traffic continues on Path 1 only.');
            }
        }

        // Auto-start animation after page load
        window.addEventListener('load', () => {
            setTimeout(startAnimation, 1000);
        });
    </script>
</body>
</html>