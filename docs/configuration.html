<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Guide - FRER Test Suite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .main-container {
            background: rgba(255,255,255,0.97);
            border-radius: 20px;
            padding: 40px;
            margin: 40px auto;
            max-width: 1400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .config-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }

        .config-card h4 {
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .param-table {
            width: 100%;
            margin: 20px 0;
        }

        .param-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            font-weight: 500;
        }

        .param-table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .param-table tr:hover {
            background: #f8f9fa;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .scenario-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .nav-tabs .nav-link {
            color: #666;
            border: none;
            padding: 12px 25px;
            font-weight: 500;
        }

        .nav-tabs .nav-link.active {
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px 8px 0 0;
        }

        .parameter-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #e0e0e0;
        }

        .parameter-name {
            font-weight: 600;
            color: #667eea;
            font-family: 'Courier New', monospace;
        }

        .parameter-desc {
            color: #666;
            margin-top: 5px;
        }

        .parameter-value {
            background: white;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid #ddd;
            font-family: 'Courier New', monospace;
        }

        .best-practice {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: rgba(0,0,0,0.2); backdrop-filter: blur(10px);">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-diagram-3-fill"></i> FRER Test Suite
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">Home</a>
                <a class="nav-link" href="installation.html">Installation</a>
                <a class="nav-link active" href="configuration.html">Configuration</a>
                <a class="nav-link" href="troubleshooting.html">Troubleshooting</a>
                <a class="nav-link" href="api.html">API</a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <h1 class="mb-4"><i class="bi bi-gear-fill"></i> Configuration Guide</h1>

        <!-- Configuration Tabs -->
        <ul class="nav nav-tabs mb-4" id="configTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="sender-tab" data-bs-toggle="tab" data-bs-target="#sender">
                    <i class="bi bi-upload"></i> Sender Configuration
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="receiver-tab" data-bs-toggle="tab" data-bs-target="#receiver">
                    <i class="bi bi-download"></i> Receiver Configuration
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced">
                    <i class="bi bi-tools"></i> Advanced Settings
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="scenarios-tab" data-bs-toggle="tab" data-bs-target="#scenarios">
                    <i class="bi bi-file-earmark-code"></i> Test Scenarios
                </button>
            </li>
        </ul>

        <div class="tab-content" id="configTabContent">
            <!-- Sender Configuration -->
            <div class="tab-pane fade show active" id="sender">
                <div class="config-card">
                    <h4><i class="bi bi-router"></i> Sender Board Setup</h4>

                    <h5>1. Bridge and VLAN Configuration</h5>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code># Create bridge with VLAN filtering
ip link add name br0 type bridge vlan_filtering 1
ip link set br0 up

# Add interfaces to bridge
ip link set eth1 master br0
ip link set eth2 master br0
ip link set eth3 master br0

# Configure VLAN 10
bridge vlan del dev eth1 vid 1
bridge vlan del dev eth2 vid 1
bridge vlan del dev eth3 vid 1
bridge vlan add dev eth1 vid 10
bridge vlan add dev eth2 vid 10
bridge vlan add dev eth3 vid 10 pvid untagged</code></pre>
                    </div>

                    <h5>2. VCAP Classification Rules</h5>
                    <div class="parameter-card">
                        <div class="parameter-name">IF_IGR_PORT_MASK</div>
                        <div class="parameter-desc">Ingress port mask for packet classification</div>
                        <div class="parameter-value">0x008 (eth3 = bit 3)</div>
                    </div>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code>vcap add 1001 is1 10 1 VCAP_KFS_NORMAL \
  IF_IGR_PORT_MASK 0x008 0x1ff \
  ETYPE 0x0800 = \
  VCAP_AFS_S1 VID_REPLACE_ENA 1 VID_VAL 10 \
  ISDX_REPLACE_ENA 1 ISDX_ADD_VAL 1</code></pre>
                    </div>

                    <h5>3. FRER Generation Configuration</h5>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Value</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>--generation</code></td>
                                <td>1</td>
                                <td>Enable frame generation</td>
                            </tr>
                            <tr>
                                <td><code>--dev1</code></td>
                                <td>eth1</td>
                                <td>Primary output port</td>
                            </tr>
                            <tr>
                                <td><code>--dev2</code></td>
                                <td>eth2</td>
                                <td>Secondary output port</td>
                            </tr>
                            <tr>
                                <td><code>ms_enable</code></td>
                                <td>0</td>
                                <td>Member stream disabled for sender</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code>frer iflow 1 --generation 1 --dev1 eth1 --dev2 eth2</code></pre>
                    </div>

                    <div class="best-practice">
                        <i class="bi bi-lightbulb"></i> <strong>Best Practice:</strong> Always verify VCAP hit counters after configuration to ensure packets are being classified correctly.
                    </div>
                </div>
            </div>

            <!-- Receiver Configuration -->
            <div class="tab-pane fade" id="receiver">
                <div class="config-card">
                    <h4><i class="bi bi-funnel"></i> Receiver Board Setup</h4>

                    <h5>1. VCAP Ingress Classification</h5>
                    <p>Configure separate VCAP rules for each ingress port:</p>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code># Rule for eth1 (port mask 0x001)
vcap add 1001 is1 11 1 VCAP_KFS_NORMAL \
  IF_IGR_PORT_MASK 0x001 0x1ff \
  VCAP_AFS_S1 ISDX_REPLACE_ENA 1 ISDX_ADD_VAL 3

# Rule for eth2 (port mask 0x002)
vcap add 1002 is1 12 1 VCAP_KFS_NORMAL \
  IF_IGR_PORT_MASK 0x002 0x1ff \
  VCAP_AFS_S1 ISDX_REPLACE_ENA 1 ISDX_ADD_VAL 4</code></pre>
                    </div>

                    <h5>2. Compound Stream Configuration</h5>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Value</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>--enable</code></td>
                                <td>1</td>
                                <td>Enable compound stream</td>
                            </tr>
                            <tr>
                                <td><code>--alg</code></td>
                                <td>0</td>
                                <td>Vector algorithm</td>
                            </tr>
                            <tr>
                                <td><code>--hlen</code></td>
                                <td>10</td>
                                <td>History length</td>
                            </tr>
                            <tr>
                                <td><code>--reset_time</code></td>
                                <td>500</td>
                                <td>Reset timeout (ms)</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code>frer cs 0 --enable 1 --alg 0 --hlen 10 --reset_time 500</code></pre>
                    </div>

                    <h5>3. Member Stream Configuration</h5>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code># Configure member stream for eth1
frer ms eth1 28 --enable 1 --alg 1 --reset_time 500 --cs_id 0

# Configure member stream for eth2
frer ms eth2 30 --enable 1 --alg 1 --reset_time 500 --cs_id 0

# Setup ingress flows with R-TAG removal
frer iflow 3 --ms_enable 1 --ms_id 28 --pop 1 --dev1 eth3
frer iflow 4 --ms_enable 1 --ms_id 30 --pop 1 --dev1 eth3</code></pre>
                    </div>

                    <div class="warning-box">
                        <i class="bi bi-exclamation-triangle"></i> <strong>Important:</strong> Member stream IDs must be allocated using <code>frer msa eth<x></code> command first.
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="tab-pane fade" id="advanced">
                <div class="config-card">
                    <h4><i class="bi bi-sliders"></i> Advanced FRER Parameters</h4>

                    <h5>Algorithm Selection</h5>
                    <div class="parameter-card">
                        <div class="parameter-name">Sequence Recovery Algorithm</div>
                        <table class="param-table">
                            <thead>
                                <tr>
                                    <th>Value</th>
                                    <th>Algorithm</th>
                                    <th>Use Case</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>0</td>
                                    <td>Vector</td>
                                    <td>Best for high-speed networks</td>
                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>Match</td>
                                    <td>Better for variable latency</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h5>Performance Tuning</h5>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code># Optimize for low latency
frer cs 0 --hlen 5 --reset_time 100

# Optimize for high reliability
frer cs 0 --hlen 20 --reset_time 1000

# Disable flooding on FRER ports
bridge link set dev eth1 flood off mcast_flood off
bridge link set dev eth2 flood off mcast_flood off</code></pre>
                    </div>

                    <h5>VLAN Advanced Configuration</h5>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code># Configure FRER VLAN parameters
frer vlan 10 --flood_disable 0 --learn_disable 0

# Enable/disable specific features
frer vlan 10 --flood_disable 1  # Disable flooding
frer vlan 10 --learn_disable 1  # Disable MAC learning</code></pre>
                    </div>

                    <h5>Debug Settings</h5>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code># Enable verbose logging
echo 8 > /proc/sys/kernel/printk

# Monitor kernel messages
dmesg -w | grep -i frer

# Capture R-TAG frames
tcpdump -i any -n -e -XX ether proto 0xf1c1 -w frer_capture.pcap</code></pre>
                    </div>
                </div>
            </div>

            <!-- Test Scenarios -->
            <div class="tab-pane fade" id="scenarios">
                <div class="config-card">
                    <h4><i class="bi bi-list-check"></i> Test Scenarios</h4>

                    <div class="scenario-box">
                        <h5>Scenario 1: Basic Functionality Test</h5>
                        <p>Verify basic frame replication and elimination.</p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                            <pre><code># Generate test traffic
iperf3 -c 10.0.100.2 -u -b 100M -t 60

# Monitor statistics
watch -n 1 'frer cs 0 --cnt'</code></pre>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>Scenario 2: Link Failure Test</h5>
                        <p>Test redundancy by simulating link failure.</p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                            <pre><code># Disable one path
ip link set eth2 down

# Verify traffic continues via eth1
tcpdump -i eth1 -c 100

# Re-enable path
ip link set eth2 up</code></pre>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>Scenario 3: Performance Test</h5>
                        <p>Maximum throughput and latency testing.</p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                            <pre><code># High-throughput test
iperf3 -c 10.0.100.2 -u -b 950M -t 300

# Latency measurement
sockperf ping-pong -i 10.0.100.2 -p 5001 --time 60

# Monitor system resources
top -b -n 1 | head -20</code></pre>
                        </div>
                    </div>

                    <div class="scenario-box">
                        <h5>Scenario 4: Out-of-Order Handling</h5>
                        <p>Test sequence recovery capabilities.</p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                            <pre><code># Add artificial delay to one path
tc qdisc add dev eth2 root netem delay 10ms

# Send traffic and check for reordering
python3 test_sequence_order.py

# Remove delay
tc qdisc del dev eth2 root</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Files Section -->
        <div class="config-card mt-5">
            <h4><i class="bi bi-file-earmark-text"></i> Configuration Files</h4>
            <p>All configurations can be saved and loaded from files:</p>

            <div class="row">
                <div class="col-md-6">
                    <h5>sender_config.yaml</h5>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code>board:
  type: sender
  model: LAN9662

network:
  bridge: br0
  vlan: 10

vcap:
  - rule_id: 1001
    priority: 10
    lookup: 1
    port_mask: 0x008
    isdx: 1

frer:
  iflow:
    - id: 1
      generation: true
      dev1: eth1
      dev2: eth2</code></pre>
                    </div>
                </div>

                <div class="col-md-6">
                    <h5>receiver_config.yaml</h5>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)"><i class="bi bi-clipboard"></i></button>
                        <pre><code>board:
  type: receiver
  model: LAN9662

network:
  bridge: br0
  vlan: 10

vcap:
  - rule_id: 1001
    port_mask: 0x001
    isdx: 3
  - rule_id: 1002
    port_mask: 0x002
    isdx: 4

frer:
  compound_stream:
    id: 0
    enable: true
    algorithm: 0
    history_len: 10</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Reference Card -->
        <div class="config-card mt-5">
            <h4><i class="bi bi-card-list"></i> Quick Reference</h4>
            <div class="row">
                <div class="col-md-4">
                    <h6>Check Status</h6>
                    <code>frer cs 0 --cnt</code><br>
                    <code>vcap get 1001</code><br>
                    <code>bridge vlan show</code>
                </div>
                <div class="col-md-4">
                    <h6>Clear Counters</h6>
                    <code>frer cs 0 --clr</code><br>
                    <code>frer ms eth1 28 --clr</code><br>
                    <code>frer ms eth2 30 --clr</code>
                </div>
                <div class="col-md-4">
                    <h6>Monitor Traffic</h6>
                    <code>tcpdump -i eth1 -n</code><br>
                    <code>watch -n 1 'frer cs 0 --cnt'</code><br>
                    <code>ip -s link show</code>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
    <script>
        function copyCode(button) {
            const codeBlock = button.parentElement.querySelector('code');
            const text = codeBlock.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="bi bi-check"></i> Copied!';
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                }, 2000);
            });
        }
    </script>
</body>
</html>